version: "3.8"

# ──────────────────────────────
# 🔹 NETWORKS (same topology)
# ──────────────────────────────
networks:
  mgmt:
    driver: bridge
    ipam:
      config:
        - subnet: "172.20.0.0/24"
  dmz:
    driver: bridge
    ipam:
      config:
        - subnet: "172.21.0.0/24"
  internal:
    driver: bridge
    ipam:
      config:
        - subnet: "172.22.0.0/24"
  secure:
    driver: bridge
    ipam:
      config:
        - subnet: "172.23.0.0/24"

# ──────────────────────────────
# 🔹 SERVICES (4 hosts)
# ──────────────────────────────
services:

  # ----------------------------
  # Controller — Ansible master
  # ----------------------------
  controller:
    image: anasslakouti/yamlforge-controller:latest
    container_name: ansible-controller
    hostname: controller
    networks:
      mgmt:
        ipv4_address: 172.20.0.100
      dmz:
        ipv4_address: 172.21.0.100
      internal:
        ipv4_address: 172.22.0.100
      secure:
        ipv4_address: 172.23.0.100
    volumes:
      - ./workspace:/workspace          # mounts your Ansible project
    tty: true
    stdin_open: true
    cap_add:
      - NET_ADMIN
      - NET_RAW

  # ----------------------------
  # Webserver (DMZ zone)
  # ----------------------------
  webserver:
    image: anasslakouti/yamlforge-node:latest
    container_name: ansible-webserver
    hostname: webserver
    networks:
      dmz:
        ipv4_address: 172.21.0.10
    tty: true
    stdin_open: true
    cap_add:
      - NET_ADMIN
      - NET_RAW

  # ----------------------------
  # Appserver (Internal zone)
  # ----------------------------
  appserver:
    image: anasslakouti/yamlforge-node:latest
    container_name: ansible-appserver
    hostname: appserver
    networks:
      internal:
        ipv4_address: 172.22.0.10
    tty: true
    stdin_open: true
    cap_add:
      - NET_ADMIN
      - NET_RAW

  # ----------------------------
  # DBserver (Secure zone)
  # ----------------------------
  dbserver:
    image: anasslakouti/yamlforge-node:latest
    container_name: ansible-dbserver
    hostname: dbserver
    networks:
      secure:
        ipv4_address: 172.23.0.10
    tty: true
    stdin_open: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
