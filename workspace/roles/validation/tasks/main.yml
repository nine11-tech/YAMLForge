---
# roles/validation/tasks/main.yml

- name: Check web server port 80 availability
  wait_for:
    host: 172.21.0.10
    port: 80
    timeout: 5


- name: Check app server port 8080 availability
  wait_for:
    host: 172.22.0.10
    port: 8080
    timeout: 5

- name: Check database server port 3306 availability
  wait_for:
    host: 172.23.0.10
    port: 3306
    timeout: 5

- name: Verify app server connectivity to DB
  shell: |
    nc -z 172.23.0.10 3306
  register: db_connection
  ignore_errors: yes

- name: Validate HTTPS web response
  uri:
    url: https://172.21.0.10
    validate_certs: no
  register: web_response
  ignore_errors: yes

- name: Generate validation report
  template:
    src: report.txt.j2
    dest: /workspace/validation_report.txt
  delegate_to: localhost